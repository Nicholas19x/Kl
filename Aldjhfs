local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local currentTarget

local function findNewTarget()
    -- ฟังก์ชันนี้จะคืนค่ามอนสเตอร์ตัวใหม่ที่เป็นเป้าหมาย
    for _, v in pairs(Workspace.Monster.Mon:GetChildren()) do
        if v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
            return v
        end
    end
    return nil
end

local function moveTo(position)
    if humanoidRootPart then
        local tweenInfo = TweenInfo.new(
            1,  -- Duration of the tween in seconds
            Enum.EasingStyle.Linear,  -- Easing style
            Enum.EasingDirection.InOut  -- Easing direction
        )

        local goal = { CFrame = position }
        local tween = TweenService:Create(humanoidRootPart, tweenInfo, goal)
        tween:Play()
    end
end

spawn(function()
    while task.wait(0.1) do
        if _G.Auto_Farm then
            if player.PlayerGui.MainGui.QuestBoard.Visible == true then
                if not currentTarget or (currentTarget:FindFirstChild("Humanoid") and currentTarget.Humanoid.Health <= 0) then
                    currentTarget = findNewTarget()
                end
                if currentTarget then
                    -- Move to the position 2.5 times the height above the head
                    local heightAboveHead = currentTarget.HumanoidRootPart.Size.Y * 2.5
                    local targetPosition = currentTarget.HumanoidRootPart.CFrame * CFrame.new(0, heightAboveHead, 0)
                    moveTo(targetPosition)
                end
            end
        end
    end
end)
