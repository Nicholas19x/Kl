local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

local Window = OrionLib:MakeWindow({Name = "Title of the library", HidePremium = false, SaveConfig = true, ConfigFolder = "OrionTest"})

local AutofarmSettingTab = Window:MakeTab({
    Name = "Setting",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local AutofarmTab = Window:MakeTab({
    Name = "Auto farm",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local melee = game:GetService("Players").LocalPlayer.PlayerStats.FightingStyle
local sword = game:GetService("Players").LocalPlayer.PlayerStats.SwordName

AutofarmSettingTab:AddDropdown({
    Name = "Weapon",
    Default = "melee",
    Options = {"melee", "sword"},
    Callback = function(Value)
        if Value == "melee" and melee then
        elseif Value == "sword" and sword then
        end
    end    
})

function checklevel()
    local lv = game:GetService("Players").LocalPlayer.PlayerStats.lvl.Value
    if lv == 1 or lv <= 2000 then
        Mon = "Soldier [Lv. 1]"
        QuestName = "Kill 4 Soldiers"
    end
end

local function teleportToTarget(position)
    local player = game.Players.LocalPlayer
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")

    if hrp then
        -- Teleport to the target position
        hrp.CFrame = position
    end
end

local function findNewTarget()
    for _, v in pairs(game:GetService("Workspace").Monster.Mon:GetChildren()) do
        if v.Name == Mon and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
            return v
        end
    end
    return nil
end

local function setupPositionControl(hrp, targetPosition)
    -- Clear existing BodyGyro and BodyPosition if they exist
    local existingGyro = hrp:FindFirstChild("BodyGyro")
    if existingGyro then existingGyro:Destroy() end
    
    local existingPosition = hrp:FindFirstChild("BodyPosition")
    if existingPosition then existingPosition:Destroy() end

    -- Create and configure new BodyGyro
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.Parent = hrp
    bodyGyro.CFrame = targetPosition
    bodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
    bodyGyro.P = 10000
    bodyGyro.D = 1000

    -- Create and configure new BodyPosition
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.Parent = hrp
    bodyPosition.Position = targetPosition.Position
    bodyPosition.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyPosition.P = 10000
    bodyPosition.D = 1000
end

spawn(function()
    while task.wait(0.1) do
        pcall(function()
            if _G.Auto_Farm then
                checklevel()
                if game:GetService("Players").LocalPlayer.PlayerGui.MainGui.QuestBoard.Visible == false then
                    if QuestName and QuestName ~= "" then
                        local args = {
                            [1] = "take",
                            [2] = QuestName
                        }
                        game:GetService("ReplicatedStorage").Chest.Remotes.Functions.Quest:InvokeServer(unpack(args))
                    end
                end
            end
        end)
    end
end)

spawn(function()
    local currentTarget = nil
    while task.wait(0.1) do
        if _G.Auto_Farm then
            if game:GetService("Players").LocalPlayer.PlayerGui.MainGui.QuestBoard.Visible == true then
                if not currentTarget or (currentTarget:FindFirstChild("Humanoid") and currentTarget.Humanoid.Health <= 0) then
                    currentTarget = findNewTarget()
                end

                if currentTarget and currentTarget:FindFirstChild("Humanoid") and currentTarget.Humanoid.Health > 0 then
                    -- Move to the position 2.5 times the height above the head
                    local heightAboveHead = currentTarget.HumanoidRootPart.Size.Y * 2.5
                    local targetPosition = currentTarget.HumanoidRootPart.CFrame * CFrame.new(0, heightAboveHead, 0)
                    teleportToTarget(targetPosition)
                    
                    -- Apply BodyGyro and BodyPosition to maintain position
                    local player = game.Players.LocalPlayer
                    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        setupPositionControl(hrp, targetPosition)
                        -- Ensure BodyGyro and BodyPosition stay in sync
                        hrp.CFrame = targetPosition * CFrame.Angles(math.rad(-90), 0, 0)
                    end
                end
            end
        end
    end
end)

AutofarmTab:AddToggle({
    Name = "Auto farm",
    Default = false,
    Callback = function(Value)
        _G.Auto_Farm = Value

        local player = game.Players.LocalPlayer
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        
        if not _G.Auto_Farm then
            -- Clean up BodyGyro and BodyPosition when toggled off
            if hrp then
                local existingGyro = hrp:FindFirstChild("BodyGyro")
                if existingGyro then existingGyro:Destroy() end
                
                local existingPosition = hrp:FindFirstChild("BodyPosition")
                if existingPosition then existingPosition:Destroy() end
            end
        end
    end    
})
